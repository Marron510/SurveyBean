<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Survey Results</title>
    <link rel="stylesheet" th:href="@{/css/survey-results.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<header class="header">
    <a th:href="@{/}" class="logo">SurveyBean</a>
</header>

<div class="results-container">
    <div class="results-header">
        <h1 th:text="${results.title}">Survey Title - Results</h1>
    </div>

    <hr>

    <div th:each="question, iterStat : ${results.questions}" class="result-block">
        <h5 th:text="${(iterStat.index + 1) + '. ' + question.text}">Question Text</h5>

        <div th:switch="${question.type}">
            <div th:case="${T(com.example.SurveyBean.domain.QuestionType).SINGLE_CHOICE}">
                <div th:each="choice : ${question.choices}" class="choice-result">
                    <span class="choice-text" th:text="${choice.text} + ' (' + ${choice.count} + '표)'">Choice Text (Count)</span>
                    <div class="result-bar-container">
                        <div class="result-bar" th:style="'width: ' + (${question.choices.![count].sum() > 0 ? (choice.count * 100.0 / question.choices.![count].sum()) : 0}) + '%;'"
                             th:text="${#numbers.formatDecimal((question.choices.![count].sum() > 0 ? (choice.count * 100.0 / question.choices.![count].sum()) : 0), 1, 1)} + '%'">
                        </div>
                    </div>
                </div>
            </div>
            <div th:case="${T(com.example.SurveyBean.domain.QuestionType).MULTIPLE_CHOICE}">
                <div th:each="choice : ${question.choices}" class="choice-result">
                    <span class="choice-text" th:text="${choice.text} + ' (' + ${choice.count} + '표)'">Choice Text (Count)</span>
                    <div class="result-bar-container">
                        <div class="result-bar" th:style="'width: ' + (${question.choices.![count].sum() > 0 ? (choice.count * 100.0 / question.choices.![count].sum()) : 0}) + '%;'"
                             th:text="${#numbers.formatDecimal((question.choices.![count].sum() > 0 ? (choice.count * 100.0 / question.choices.![count].sum()) : 0), 1, 1)} + '%'">
                        </div>
                    </div>
                </div>
            </div>

            <div th:case="${T(com.example.SurveyBean.domain.QuestionType).TEXT}">
                <ul class="subjective-answers-list">
                    <li th:each="answer : ${question.subjectiveAnswers}" class="subjective-answer" th:text="${answer}">
                        Subjective answer text.
                    </li>
                    <li th:if="${question.subjectiveAnswers == null or question.subjectiveAnswers.isEmpty()}">
                        <p>주관식 답변이 없습니다.</p>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

</body>
</html>